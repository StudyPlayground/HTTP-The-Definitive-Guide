브라우저 커넥션

`http://www.joes-hardware.com:80/power-tools.html`

이라는 주소가 있을 때,

(1) 브라우저가 [www.joes-hardware.com](http://www.joes-hardware.com) 이라는 호스트 명을 호출한다.

(2) 브라우저가 이 호스트명에 대한 ip 주소를 찾는다(호스트 명 ⇒ IP(ex) 202.43.78.3))

(3) 브라우저가 **포트 번호를 얻는다.(80)**

(4) 브라우저가 202.43.78.3 의 80포트로 TCP 커넥션을 생성한다.

(5) 브라우저가 서버로 HTTP GET 요청 메시지를 보낸다.

(6) 브라우저가 서버에서 온 HTTP 응답 메시지를 읽는다.

(7)브라우저가 커넥션을 끊는다.  

### 4.1.1 신뢰할 수 있는 데이터 전송 통로인 TCP

TCP는 인터넷을 안정적으로 연결한다. 

### 4.1.2 TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다.

TCP는 **IP 패킷이**라고 불리는 작은 조각을 통해 데이터를 전송한다. HTTP는 ‘IP, TCP, HTTP’로 구성된 프로토콜 스택에서 **최상위 계층이다.**  

HTTP에 보안 기능을 더한 HTTPS 는 TLS혹은 SSL이라고 불리기도 하며, HTTP와 TCP 사이에 있는 암호화 계층이다. 



각 TCP 세그먼트는 하나의 IP 주소에서 다른 IP 주소로 IP 패킷에 담겨 전달된다. 

이 모든 것은 TCP/IP 소프트웨어에 의해 처리되며, 그 과정은 HTTP프로그래머에게 보이지 않는다. 

이 IP패킷들 각각은 다음을 포함한다. 

IP 패킷 헤더 (보통 20 byte)

TCP 세그먼트 헤더(보통 20 byte)

TCP 데이터 조각 (0 혹은 그 이상의 바이트)

IP헤더는 발신지와 목적지 IP 주소, 크기, 기타 플래그를 가진다. TCP 세그먼트 헤더는 TCP 포트 번호, TCP제어 플레그, 글고 데이터의 순서와 무결성을 검사하기 위해 사용되는 숫자 값을 포함한다. 

### 4.1.3 TCP 커넥션 유지하기

컴퓨터는 항상 TCP 커넥션을 여러개 가지고 있다. TCP는 포트 번호를 통해 이런 여러 개의 커넥션을 유지한다.

포트 번호는 회사 직원의 내선 전화와 같다. 회사의 대표 전화번호는 안내데스크로 연결되고 내선 전화는 해당 직원으로 연결되듯이, IP 주소는 해당 컴퓨터에 연결되고 포트 번호는 해당 애플리케이션으로 연결된다. TCP 커넥션은 내 가지 값으로 식별한다. 

<발신지 IP, 발신지 포트, 수신지 IP 주소, 수신지 포트>

이 네 가지 값으로 유일한 커넥션을 생성한다. 서로 다른 두 개의 TCP 커넥션은 네 가지 주소 구성요소의 값이 같을 수 없다. 

- HTTP  ⇒ 어플리케이션 레벨
- TLS OR SSL (보안 레벨)
- TCP ⇒ 전송 레벨
- IP ⇒ 네트워크 레벨

### 4.1.4 TCP 소켓 프로그래밍

운영 체제는 TCP 커넥션의 생성과 관련된 여러 기능을 제공한다. 소켓 api는 HTTP 프로그래머에게 TCP와 IP의 세부사항들을 숨긴다. 소켓 API는 유닉스 운영체제용으로 먼저 개발되었지만 지금은 소켓 API의 다양한 구현체들 덕분에 대부분의 운영 체제와 프로그램 언어에서 이ㅡㄹ 사용할 수 있게 되었다.

소켓 API를 사용하면 TCP endpoint 데이터 구조를 생성하고 원격 서버의 TCP 종단에 그 종단 데이터 구조를 연결해 데이터 스트림을 읽고 쓸 수 있다. 

TCP 종단에 그 종단 데이터 구조를 연결해 데이터 스트림을 읽고 쓸 수 있다. 

TCP API는 기본적인 네트워크 프로토콜의 핸드셰이킹, 그리고 TCP 데이터 스트림과 IP 패킷 간의 분할 및 재조립에 대한 모든 세부사항을 외부로부터 숨긴다. 

- 순서

## 4.2 TCP의 성능에 대한 고려

HTTP는 TCP 바로 위 계층이기 때문에 HTTP 트랜잭션의 성능은 그 아래 계층인 TCP 성능에 영향을 받는다. 

### 4.2.1 HTTP 트랜잭션 지연

트랜잭션을 처리하는 시간은 TCP 커넥션을 설정하고, 요청을 전송하고, 응답 메시지를 보내는 것에 비하면 상당히 짧다. 클라이언트나 서버가 너무 많은 데이터를 내려받거나 복잡하고 동적인 자원들을 실행하지 않는 한, 대부분의 HTTP 지연은 TCP 네트워크 지연 때문에 발생한다.

HTTP 트랜잭션을 지연시키는 원인은 여러 가지가 있다.

1. 클라이언트는 URI에서 웹 서버의 IP 주소와 포트 번호를 알아내야 한다. 만약 URI에 기술되어 있는 호스트에 방문한 적이 최근에 없으면, DNS 이름 분석 인프라를 이용해 URI에 있는 호트스 명을 IP 주소로 변환하는데 수십 초의 시간이 걸린다. (host / nslookup 명령어 사용해봐)

```tsx
PS C:\Users\n_you> nslookup google.com
서버:    bns1.hananet.net
Address:  210.220.163.82

권한 없는 응답:
이름:    google.com
Addresses:  2404:6800:400a:804::200e
          172.217.25.174

PS C:\Users\n_you> nslookup naver.com
서버:    bns1.hananet.net
Address:  210.220.163.82

권한 없는 응답:
이름:    naver.com
Addresses:  223.130.195.95
          223.130.200.104
          223.130.195.200
          223.130.200.107
```

1. 다음으로, 클라이언트는 TCP 커넥션 요청을 서버에게 보내고 서버가 커넥션 허가 응답을 회신하기를 기다린다. 커넥션 설정 시간은 새로운 tcp 커넥션에서 항상 발생한다. 이는 보통 1~2초의 시간이 소요되지만, 수 백개의 http트랜잭션이 만들어지면 소요 시간은 크게 증가할 것이다. 
2. 커넥션이 맺어지만 클라이언트는 HTTP 요청을 새로 생성된 TCP 파이프를 통해 전송한다. 웹 서버는 데이터가 도착하는 대로 TCP 커넥션에서 요청 메시지를 읽고 처리한다. 요청 메시지가 인터넷을 통해 전달된다.
