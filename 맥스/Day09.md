---
marp: true
paginate: true
---

# Content Negotiation

---

## Content? Negotitation?

- Content
  - 클라이언트가 서버에게 요청하는 `자료`
- Negotitation
  - 어떤 Content를 주고 받을지 `협상`

---

## 클라이언트 주도 협상

- 클라이언트가 Cotent를 선택한다.
- 1차 요청
  - 클라이언트: @@문서 주세요~
  - 서버: 무슨 언어로된 문서를 드릴까요?
- 2차 요청
  - 클라이언트: &&언어로된 @@문서 주세요~
  - 서버: 여기 있습니다!

---

## 클라이언트 주도 협상 특징

- 원하는 데이터를 위해 `요청이 2번` 일어난다.
- 링크를 공유했을때 동일한 컨텐츠를 본다는 보장이 되지 않는다.

---

## 서버 주도 협상

- 서버가 Cotent를 선택한다.
- HTTP Header를 이용한다.
  - Accept, Accept-Language 등
  - `q값`을 이용하여 우선순위를 표시한다.
- 요청
  - 클라이언트: @@문서 주세요!
  - 서버: (q값이 높은 ko를 확인하고) 한국어로된 @@문서 여기요~

---

## 서버 주도 협상 특징

- 1번의 요청을 하지만, `요청에 포함되는 데이터`가 많아진다.
- 서버에서 어떠한 컨텐츠를 선택할지 매커니즘이 필요하다.

---

## 투명 협상

- 중간에 Proxy가 캐시 기능을 지원한다.
- 요청
  - 클라이언트: @@문서 주세요!
  - Proxy: 캐시된 문서가 아니네? 서버에게 전달~
  - 서버: @@문서 여기요~
    - HTTP Header에 `Vary속성`에 어떤 값을 일치해야하는지 적어줌
  - Proxy: 사본 저장하고 클라이언트에게 전달~
- 동일 요청
  - 클라이언트: @@문서 주세요!
  - Proxy: (Vary속성에 있는 값을 비교한 후) 동일하니 캐시 데이터 반환~

---

## 투명 협상 특징

- 서버 주도 협상의 특징을 그대로 가지고 있다.
- Proxy의 캐싱 기능으로 서버의 부하가 적다.

---

## 구글의 컨텐츠 협상은 어떻게 할까?

- `User-Agent Header`를 통해 사용자의 기기에 알맞는 콘텐츠를 제공
- `Accept Header`를 통해 미디어 타입과 적합한 콘텐츠를 제공
- `IP`를 통해 지리적 위치를 바탕으로 적절한 콘텐츠를 제공
- `사용자 설정`을 통해 개인화된 컨텐츠 제공
- [ChatGPT 답변](https://github.com/StudyPlayground/HTTP-The-Definitive-Guide/assets/75886763/ebb1200e-1fa2-462c-bde0-ab3853b3e48a)

---

### 관련 단원

- 17장 내용 협상과 트랜스코딩

### 참고 링크

- [내용협상과 트랜스코딩 | 필오의 개발 docs](https://feel5ny.github.io/2020/01/20/HTTP_017/)
