## HTTP 리다이렉트

- URL 리다이렉션, 포워딩 : 
페이지 단위의 실제 리소스, 폼, 전체 웹 애플리케이션이 다른 URL에 위치한 상태에서 링크를 존속키기는 기술
- 특별한 종류의 응답 HTTP redirect
    - 사이트 유지 관리가 진행 중인 상태에서의 일시적 리다이렉션
    - 사이트 아키텍쳐 변경 이후에도 외부 링크를 동작하는 상태로 유지시키기 위한 영구 리다이렉션 등

### 원칙

- 요청에 대해 특별한 응답인 리다이렉트를 전송함으로써 촉발됨
- **3xx 상태 코드**를 지닌 응답
- 리다이렉트 응답을 수신한 브라우저는 “제공된 새로운 URL”을 사용하며, 이걸 즉시 로드함
- 대부분의 경우, 사용자에게 리다이렉션은 보이지 않으며, 적은 성능 저하를 일으킴
    
    ![스크린샷 2023-08-08 오전 11.14.58.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e3abc98e-5623-441b-9fc3-60ce3897cb15/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-08-08_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.14.58.png)
    

## 유형

### 영속적인 리다이렉션 (Moved Permanently)

- 리다이렉션이 영원히 지속됨
- 원래 URL이 더 이상 사용되지 않아야 하며, **새로운 URL을 더 선호**해야 함
- 검색 엔진 로봇은 리소스에 대한 연관 URL의 갱신을 촉발시킴

| 코드 | 텍스트 | 메서드 핸들링 | useCase |  |
| --- | --- | --- | --- | --- |
| 301 | Move Permanently | - GET 메서드는 변경 안 됨
- 다른 메서드들은 GET으로 변하거나 변하지 않을 수도 있음   | 웹 사이트의 재편성 | - 요청한 리소스가 Location 헤더에 주어진 URL로 완전히 옮겨졌음
- 브라우저는 이 페이지로 리다이렉트, 검색 엔진은 해당 리소스로 연결되는 링크를 갱신함 
- GET, HEAD 메소드에 대한 응답으로만 사용하기! (POST는 308 사용이 바람직) |
| 308 | Permanent Redirect | - 메서드, 본문은 변경 안 됨 | GET이 아닌 링크/ 동작을 지닌, 웹 사이트의 재편성  |  |

### 일시적인 리다이렉션

- 때때로 요청된 리소스가 다른 위치에서 접근 가능한 경우에 사용
- 검색 엔진 로봇은 일시적은 링크를 기억 못함
- 일시적인 진행율 페이지 등을 표시하고자 리소스를 만들고, 갱신,삭제할 때 등 사용

| 코드 | 텍스트 | 메서드 핸들링 | useCase |  |
| --- | --- | --- | --- | --- |
| 302 | Found | - GET 메서드 변경 안 됨
- 다른 메서드들은 GET으로 변경/변하지 않을 수도 있음 | 웹 페이지가 예측 못한 이유로 일시적으로 이용 불가할 때 (검색 엔진 링크 갱신 안 함) | - 요청 리소스가 Location 헤더에 지정된 URL로 일시적으로 이동되었음 
- 브라우저가 이 페이지로 리디렉션되지만, 검색 로봇은 해당 링크를 갱신 안함 
- GET, HEAD 메서드에 대한 응답으로만 설정하기 (사용하던 메서드를 GET으로 변경하려면 303 사용하기) |
| 303  | See Other | - GET 메서드 변경 안 됨
- 다른 메서드들은 GET 메서드로 변경됨 (본문 잃음) | 동작을 다시 촉발시키는 페이지 리프레시를 막기 위해, PUT/ POST 뒤에 사용 | - 리디렉션이 요청한 리소스 자체에 연결 X → 다른 페이지 (확인 페이지 , 업로드 행률 페이지 ) 등에 연결됨을 나타냄 
- PUT, POST의 결과로 다시 전송되는 경우가 많음 
- 항상 GET으로  |
| 307 | Temporary Redirect | - 메서드, 본문 변경 안 됨 | 웹 페이지가 예측 못한 이유로 일시적으로 이용 불가할 때 (검색 엔진 링크 갱신 안 함)
* GET이 아닌 링크/ 동작이 사이트에서 이용가능할 때 302보다 더 좋음  | - 원래 요청한 메소드, 바디를 재사용하여 요청을 리다이렉트 
- 302와 다른 점: 307은 메소드, 바디를 변경하지 않고 리다이렉트 요청하도록 보장함  |

### 특수 리다이렉션

- 304(수정되지 않음)은 (오래된) 로컬에 캐시된 복사본으로 페이지를 리다이렉트 시킴
- 300(다중 선택)은 수동 리다이렉션
    - 브라우저에 의해 웹페이지 본문에 가능한 리다이렉션을 나열 → 사용자가 그 중 하나 클릭

| 코드 | 텍스트 | useCase |  |
| --- | --- | --- | --- |
| 300 | Multiple Choice | - 경우 많지 않음
- 본문 HTML 페이지 내 선택지 나열
- 200 ok 상태와 함께 서브 가능  | 요청에 가능한 응답이 2개 이상일 때  |
| 304 | Not Modified | 캐시 리프레시 : 캐시 값이 여전히 사용 가능할 정도로 신선함을 가리킴  | - 요청된 리소스를 재전송할 필요가 없음을 나타냄
- 캐시된 자원으로의 암묵적 리딩렉션 
- GET, HEAD 요청처럼 안전한 경우, 요청이 조건부로 If-None-Match / If-Modified-Since 헤더를 사용할 때 응답됨  |

## 리다이렉션을 정의하는 다른 두 방법

- HTTP 리다이렉트는 리다이렉션을 만드는 가장 좋은 방법
- 그러나 웹 개발자가 서버 제어권이 없거나 구성할 수 없는 경우
    - refresh를 설정하기 위해
        - 페이지의 <head> 내 <meta> 엘리먼트, http-equiv 속성으로 HTML 페이지 만들 수 있음
        - 해당 페이지를 디스플레이할 때, 브라우저는 이 엘리먼트를 발견하고 표시된 페이지로 이동할 것!

### <meta> HTML 리다이렉션

```jsx
<head>
	<meta http-equiv="refresh" content="0;URL='http://www.example.com/'" />
</head>
```

- content 속성 : 주어진 URL로 리다이렉션 하기 이전에 브라우저가 얼마만큼의 시간(초)를 기다려야 하는지 나타내는 수자로 시작됨 ( 나은 접근성을 위해 0으로 설정하기!)
- HTML 페이지에서만 동작하며, 이미지 등 다른 종류의 콘텐츠에서 사용될 수 없음
- 브라우저의 뒤로 가기 버튼이 무용지물이 됨!

### DOM 사용 자바사크립트 리다이렉션

```jsx
window.location = "http://www.example.com/"
```

- HTML 리다이렉션처럼, 모든 리소스에서 동작하는 것은 아님
- 명백하게 자바스크립트를 실행한 클라이언트 상에서만 동작
- 다른 점 : 어떤 조건이 충족되는 경우에만 리다이렉션을 촉발시킬 수 있음! (조건을 설정할 수 있음)

## 리다이렉션의 우선 순위

- URL 리다이렉션이 3가지로 가능, 무엇이 먼저 적용될까?

1. 페이지가 읽힌 적도, 전송된 적도 없는 경우 → HTTP 리다이렉트가 항상 먼저 실행됨 
2. 어떤 HTTP 리다이렉트도 없는 경우 → HTML 리다이렉트 (<meta>) 실행
3. 자바스크립트 리다이렉트는 최후의 수단, 클라이언트 측에서 자바스크립트를 활성화시킨 경우에만 

- 가능한 항상 HTTP 리다이렉트를 사용하고, <meta> 엘리먼트는 사용하지 말기

## 유스 케이스

- 리다이렉트는 성능과 직결되므로 사용을 최소화하기

### Domain Aliasing

<aside>
💡 여러 개의 도메인을 서로 다른 이름, 식별자로 매핑하는 프로세스 
→ 각 도메인을 분리, 모듈화하여 독립적으로 작동하고 서로 활용하도록

</aside>

- 하나의 로케이션 존재, 하나의 리소스에 대해 하나의 URL이 존재한다고 가정
- 하나의 리소스에 대해 대체 이름을 갖고자 할 때
    - www 접두사를 갖지 않는 도메인, 더 짧고 기억하기 쉽게 만든 URL
- 리소스를 복제하기 보다 실제 (정식) URL에 대한 리다이렉트를 사용하는 것이 더 유용함!

도메인 앨리어싱 유스 케이스

1. 사이트 범위 확장
    1. 내 사이트가 [www.example.com](http://www.example.com) 도메인을 가지고 있을 때
    2. [example.com](http://example.com) 을 통한 접근도 가능한 경우에 해당 
    3. [example.com](http://example.com) → www.example.com으로 리다이렉션 
2. 다른 도메인으로 이동
    1. 회사의 이전 이름으로 검색하는 경우, 새로운 이름의 사이트로 리다이렉션
3. HTTPS 강제
    1. 사이트에 대한 http 요청이 있을 경우, https 버전으로 리다이렉트 

### 링크 유지하기

- 웹 사이트를 다시 만든다면? 리소스의 URL이 변경되기 마련
- 이전 URL 사용자가 있으므로, 새로운 URL로의 리다이렉트 설정하기!

### 안전하지 않은 요청에 대한 일시적인 응답

- Unsafe 요청이 서버 상태를 수정할 경우!
    - 사용자가 PUT, POST, DELETE 요청을 재전송하지 않도록
    - 서버는 303을 회신할 수 있음

### 긴 요청에 대한 일시적인 응답

- 몇몇 요청은 서버 상에서 좀 더 많은 시간을 필요로 하는 경우가 있음
- 이때 응답은 303(See Other) 리다이렉트로
    - 어떤 동작이 예정되어 있고, 진행률에 관해 알려주고, 그 동작을 취소할 수 있는 페이지로 리다이렉트