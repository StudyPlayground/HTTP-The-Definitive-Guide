# CDN (Content Delivery Network)

### 콘텐츠 (웹페이지, 이미지, 동영상) 전송 네트워크


### 이런 문제를 해결하려고!

1. 클라이언트 입장 - A 콘텐츠를 제공하는 서버가 사용자로부터 먼 곳에 위치한다면, **콘텐츠 다운로드 시간이 길었어 (속도 저하)**
2. 서버 입장 - 규모가 큰 사이트를 서빙하는 경우, 세계 각국의 수많은 사용자가 서버에 몰림 → 수**많은 요청을 감당하기가 어려웠어, 분산 시키고 싶다! (서버 부하)**

> **서버의 저장 용량은 상대적으로 비싸고, 증설하기도 어려워! 근데 정적 파일을 서빙하는 데 많은 컴퓨팅 파워도 필요 없잖아? 

정적 파일은 S3 같은 정적 파일 저장소에 올리면, 안정적으로 싼 값에 제공할 수 있을 것 같아!**
> 

### CDN의 역할

- 전 세계에 분산된 서버 네트워크를 통해 콘텐츠를 효율적으로 전송함

→ 사용자는 지리적으로 가까운 서버(체인점 같이!), 가장 빠르게 서비스를 제공할 수 있는 서버로 콘텐츠를 다운로드 가능 

- **사이트의 각종 이미지, 정적 요소들이 상당수 저장, 캐싱되어있음**

**⇒다운로드 시간 단축, 웹사이트 성능 향상**

<aside>
💡 미러 사이트
- 내용을 모두 복사해두는 것을 미러 사이트라 함 
- CDN는 서버 전체가 아니라 콘텐츠 전달이라는 역할에 특화된 것

</aside>

> CloudFront는 215개 이상의 엣지 로케이션

<aside>
💡 **어떻게 캐싱 될까?  (**https://aws.amazon.com/ko/what-is/cdn/)

1. 지리적으로 멀리 떨어진 웹 사이트 방문자는 사이트에서 정적 웹 콘텐츠를 처음 요청합니다.
2. 요청이 웹 애플리케이션 서버 또는 오리진 서버에 도달합니다. 오리진 서버는 원격 방문자에게 응답을 보냅니다. 또한 해당 방문자와 지리적으로 가장 가까운 CDN POP(접속 지점)에 응답 복사본을 보냅니다.
3. CDN POP 서버는 복사본을 캐싱된 파일로 저장합니다.
4. 다음에 해당 방문자 또는 해당 위치에 있는 다른 방문자가 동일한 요청을 하면, 오리진 서버가 아닌 캐싱 서버가 응답을 보냅니다.
</aside>

### CDN에 캐싱은 언제 될까?

<aside>
💡 정적 캐싱과 동적 캐싱

1. 정적 캐싱: 캐싱할 것들을 **미리 각 엣지에 보내는 것** 
 
2. 동적 캐싱: 사용자가 요청을 할 때마다 **응답할 콘텐츠가 엣지에 있는지 확인한 다음** 
 있다면 (=cache hit) 바로 사용자에게 보내고 
 없으면 (cache miss) 서버에 요청을 받아 옴

✨가벼운 콘텐츠라면 동적 캐싱을 써도 큰 문제가 없으나, 동영상 같이 무거움 파일은 정적 캐싱을 해두어야 사용자가 이용하기에 불편함이 없음

</aside>

<aside>
💡 정적 콘텐츠와 동적 콘텐츠 

1. 정적 콘텐츠: HTML, CSS, JS 파일, 문서, 이미지, 동영상 등 그 내용이 고정된 것
2. 사용자가 입력한 내용이나 API 요청에 따라, 그때그때 변수에 따라 내용이 변할 수 있는 것

</aside>

- CDN은 일반적으로 **정적 콘텐츠를 처리하는 데 집중**
    - 주로 동적 콘텐츠는 백엔드 서버에서 처리
    - 정적 콘텐츠는 캐싱하기 쉽지만, API 요청 결과 같은 동적콘텐츠는 캐싱이 까다로움
        - 그럼에도 동적 콘텐츠를 캐싱하면서도, 전달 속도를 높이는 곳도 있다
            - Cloudflare, AWS의 CloudFront, Azure의 CDN emd
            - 동적 콘텐츠를 바이트 단위로 분석 → 바뀐 부분만 새로 받아오도록 속도를 높이고, 서버에서 사용자까지 전달 경로를 최적화, 데이터 압축, 핸드셰이크 과정 간소화 등
        - 지정된 시간에 한해서 캐싱 되도록 (날씨를 초단위로 업데이트할 필요는 없으므로)
            - 캐시에 데이터가 얼마나 남아있을지는 Time-To-Live, TTL을 지정할 수 있음
                - 같은 사이트, 서버라도 콘텐츠 종류마다 각각 지정 가능
            - 사이트의 내용이 전체적으로 바뀌어서 캐싱에 저장된 걸 한번에 바꿀 수도 있음

 

### DNS 매핑!

- 사이트 주소를 내가 검색한다면?
    - DNS 는 서버의 IP가 아니라 CDN 주소로 연결함
    (= 본사가 아니라 체인점을 총괄하는 부서 역할)
    - 대신 요청을 받은 CDN은 세계 각지의 서버(엣지) 중에서 클라이언트에게 가장 빠르게 서비스를 제공할 수 있는 엣지를 선택
    - 서버와 사용자를 주선함
        - 반드시 물리적으로 가까운 엣지는 아님!
        - 지역에 따라 트래픽이 몰리는 곳이 있으므로, CDN이 꾸준히 각 엣지들의 헬스 체크를 함

### CDN의 이점

1. **속도 향상**
2. **비용 절약 (대역폭 사용량 감소)**
    1. CDN 업체에 주는 비용도 있지만 
    2. 서버를 돌리는 비용을 더 많이 아낄 수 있기 때문! 
    3. 서버로 직접 요청이 들어오지 않으므로 **대역폭 비용이 크게 절감 됨** 
        1. 대역폭 비용이 준다는 것은, 
        2. 본사로 손님들이 직접 찾아오는 게 아님
        3. 본사로 가는 길을 넓게 할, 즉 대역폭을 넓게 할 필요가 없음 
3. 서버가 받는 부담이 줄어듦 
    1. 오류의 위험성이 줄어듦 
4. 안정적인 서비스 제공 
    1. CDN 중 하나에 이상이 생겨도 신속히 다른 CDN으로 연결되므로 안정적인 서비스 제공 가능 
5. **보안 향상**
    1. DDos 공격으로부터 서버 보호 
    
    <aside>
    💡 DDos (분산 서비스 거부)
    : 서비스 중단을 목적으로 표적 서버, 서비스, 네트워크에 **인터넷 트래픽을 대량**으로 보내려고 시도하는 악의적인 사이버 공격의 형태  → 웹사이트, 네트워크 리소스 운영이 불가하도록
    
    </aside>
    
    1. 콘텐츠 암호화 향상 (내가 서버에서 구현한 인증서의 보안 등급이 낮아도 방문자들은 CDN에서 제공하는 강력한 보안을 누릴 수 있음)
    

### reference